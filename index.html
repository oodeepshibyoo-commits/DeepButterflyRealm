<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DeepButterflyRealm 🦋</title>

<style>
/* ==== 🌑 Neon-Dunkel-Design ==== */
body {
  margin:0;
  font-family: 'Segoe UI', sans-serif;
  background: radial-gradient(circle at top, #050009, #0a0018 70%);
  color:#fff;
  overflow:hidden;
}
#topbar {
  position:fixed; top:0; left:0; right:0;
  height:50px; display:flex; align-items:center;
  justify-content:space-between;
  padding:0 20px;
  background:rgba(30,0,40,0.7);
  border-bottom:1px solid #ff3eb5;
  box-shadow:0 0 10px #ff3eb5;
}
#clockTop {
  color:#ff3eb5;
  font-weight:bold;
}
#main {
  display:flex;
  height:calc(100vh - 50px);
  margin-top:50px;
}
#sidebar {
  width:250px;
  background:rgba(20,0,40,0.7);
  border-right:1px solid #ff3eb5;
  display:flex;
  flex-direction:column;
  padding:10px;
}
#sidebar.hidden { display:none; }
#sidebar h2 { color:#ff3eb5; text-align:center; }
#chatArea {
  flex:1; display:flex; flex-direction:column;
  justify-content:space-between;
  padding:10px;
}
#chat {
  flex:1; overflow-y:auto; padding-right:10px;
}
.message {
  background:rgba(255,62,181,0.1);
  border:1px solid rgba(255,62,181,0.3);
  margin:5px 0; padding:6px 10px;
  border-radius:10px;
}
.message strong { color:#ff3eb5; }
.meta { font-size:0.8em; color:#aaa; }
#msgInput {
  width:100%; padding:10px;
  background:#15001e; color:#fff;
  border:1px solid #ff3eb5;
  border-radius:10px;
  outline:none;
}
#clockBottom {
  color:#ff3eb5; text-align:right;
  font-size:0.9em;
  margin-top:3px;
}
button {
  background:#ff3eb5; color:#fff;
  border:none; border-radius:10px;
  padding:6px 12px; margin:3px 0;
  cursor:pointer; font-weight:bold;
}
button:hover { background:#ff73cc; }

/* Avatar-Spielbereich */
#gameArea {
  position:relative; width:100%; height:300px;
  background:rgba(255,62,181,0.05);
  border:1px solid rgba(255,62,181,0.3);
  border-radius:15px; margin-top:10px;
  overflow:hidden;
}
.avatar {
  position:absolute; width:50px; height:50px;
  border-radius:50%;
  background:radial-gradient(circle,#ff3eb5,#900090);
  display:flex; align-items:center; justify-content:center;
  font-size:1.3em;
}
</style>
</head>

<body>
<div id="topbar">
  <div>🦋 <b>DeepButterflyRealm</b></div>
  <div id="clockTop"></div>
</div>

<div id="main">
  <div id="sidebar" class="hidden">
    <h2>Online</h2>
    <div id="userList"></div>
    <hr>
    <button id="startGameBtn">🎮 TicTacToe</button>
  </div>

  <div id="chatArea">
    <div id="chat"></div>
    <input id="msgInput" placeholder="Nachricht eingeben und Enter drücken...">
    <div id="clockBottom"></div>
  </div>
</div>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script>
/* === 🕒 Uhrzeit === */
function updateClocks(){
  const t=new Date().toLocaleTimeString();
  document.getElementById("clockTop").textContent=t;
  document.getElementById("clockBottom").textContent=t;
}
setInterval(updateClocks,1000);
updateClocks();

/* === 🔗 Socket Verbindung === */
const socket=io();

/* === 🌐 Google Translate === */
const GOOGLE_API_KEY="YOUR_GOOGLE_API_KEY_HERE";
async function translateText(text,target){
  try{
    const r=await fetch(`https://translation.googleapis.com/language/translate/v2?key=${GOOGLE_API_KEY}`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({q:text,target})
    });
    const data=await r.json();
    return data.data?.translations?.[0]?.translatedText||text;
  }catch(e){console.error(e);return text;}
}

/* === 💬 Chat-System === */
let username=null;
let userLang="de";
let userColor="#ff3eb5";
let isOwner=false;

/* Simpler Login */
username=prompt("Bitte gib deinen Namen ein:");
userLang=prompt("Sprache (z.B. de, hu, en):")||"de";
socket.emit("join",{user:username,lang:userLang,color:userColor});

document.getElementById("msgInput").addEventListener("keydown",async e=>{
  if(e.key==="Enter"&&e.target.value.trim()!==""){
    const text=e.target.value.trim();
    socket.emit("chat",{text,lang:userLang,color:userColor,user:username});
    e.target.value="";
  }
});

/* === 📥 Eingehende Nachrichten === */
socket.on("chat",async msg=>{
  const myLang=userLang;
  const translated=await translateText(msg.text,myLang);
  const chat=document.getElementById("chat");
  const el=document.createElement("div");
  el.className="message";
  el.innerHTML=`<strong style="color:${msg.color}">${msg.user}</strong>: ${translated}
  <div class="meta">Übersetzt aus ${msg.lang} → ${myLang}</div>`;
  chat.appendChild(el);
  chat.scrollTop=chat.scrollHeight;
});
/* === 🧍 Online-Liste aktualisieren === */
socket.on("userlist", list=>{
  const sidebar=document.getElementById("sidebar");
  if(!username)return; // Nicht eingeloggt → Liste bleibt verborgen
  sidebar.classList.remove("hidden");
  const ul=document.getElementById("userList");
  ul.innerHTML="";
  list.forEach(u=>{
    const div=document.createElement("div");
    div.textContent=u.user+(u.role==="owner"?" 👑":"");
    ul.appendChild(div);
  });
});

/* === 🦋 Avatar-Bereich === */
const gameArea=document.createElement("div");
gameArea.id="gameArea";
document.getElementById("chatArea").prepend(gameArea);

const avatars={};

socket.on("spawn",user=>{
  if(!avatars[user.user]){
    const el=document.createElement("div");
    el.className="avatar";
    el.style.left=Math.random()*250+"px";
    el.style.top=Math.random()*200+"px";
    el.textContent="🦋";
    gameArea.appendChild(el);
    avatars[user.user]=el;
  }
});

socket.on("move",data=>{
  if(avatars[data.user]){
    avatars[data.user].style.left=data.x+"px";
    avatars[data.user].style.top=data.y+"px";
  }
});

document.addEventListener("keydown",e=>{
  if(!avatars[username])return;
  const el=avatars[username];
  let x=parseInt(el.style.left)||0;
  let y=parseInt(el.style.top)||0;
  if(e.key==="ArrowLeft")x-=10;
  if(e.key==="ArrowRight")x+=10;
  if(e.key==="ArrowUp")y-=10;
  if(e.key==="ArrowDown")y+=10;
  el.style.left=x+"px";
  el.style.top=y+"px";
  socket.emit("move",{user:username,x,y});
});

/* === 🎮 Einfaches Tic-Tac-Toe === */
let tttBoard=null;
function createTicTacToe(){
  if(document.getElementById("ttt"))return;
  const wrap=document.createElement("div");
  wrap.id="ttt";
  wrap.innerHTML="<h3 style='color:#ff3eb5;text-align:center;'>🎮 TicTacToe</h3>";
  const table=document.createElement("table");
  table.style.margin="0 auto";
  table.style.borderCollapse="collapse";
  table.style.boxShadow="0 0 10px #ff3eb5";
  for(let r=0;r<3;r++){
    const tr=document.createElement("tr");
    for(let c=0;c<3;c++){
      const td=document.createElement("td");
      td.dataset.pos=r+","+c;
      td.style.width="60px";td.style.height="60px";
      td.style.textAlign="center";td.style.fontSize="2em";
      td.style.border="1px solid #ff3eb5";
      td.addEventListener("click",()=>{
        if(!td.textContent){
          td.textContent="❌";
          socket.emit("ttt-move",{pos:td.dataset.pos,symbol:"❌"});
        }
      });
      tr.appendChild(td);
    }
    table.appendChild(tr);
  }
  wrap.appendChild(table);
  document.getElementById("chatArea").appendChild(wrap);
  tttBoard=table;
}
document.getElementById("startGameBtn").addEventListener("click",()=>{
  createTicTacToe();
  socket.emit("ttt-start");
});

socket.on("ttt-start",()=>createTicTacToe());
socket.on("ttt-move",data=>{
  if(tttBoard){
    const cell=tttBoard.querySelector(`[data-pos='${data.pos}']`);
    if(cell&&!cell.textContent)cell.textContent=data.symbol==="❌"?"⭕":"❌";
  }
});

/* === 👑 Owner & Admin-Befehle === */
socket.on("system",msg=>{
  const chat=document.getElementById("chat");
  const el=document.createElement("div");
  el.className="message";
  el.style.opacity=0.7;
  el.innerHTML=`<em>${msg}</em>`;
  chat.appendChild(el);
});
/* === 🔐 Logout & Cleanup === */
window.addEventListener("beforeunload",()=>{
  socket.emit("leave",{user:username});
});

/* === 🦋 Verbindungssignale === */
socket.on("connect",()=>{
  socket.emit("spawn",{user:username});
});
socket.on("disconnect",()=>{
  const el=document.createElement("div");
  el.className="message";
  el.innerHTML="<em>Verbindung getrennt...</em>";
  document.getElementById("chat").appendChild(el);
});

/* === 🎆 Kleine Glitzer-Animation im Hintergrund === */
const canvas=document.createElement("canvas");
document.body.appendChild(canvas);
canvas.style.position="fixed";
canvas.style.left=0;canvas.style.top=0;
canvas.style.zIndex="-1";
const ctx=canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
window.addEventListener("resize",resize);resize();
const stars=Array.from({length:80},()=>({x:Math.random()*innerWidth,y:Math.random()*innerHeight,r:Math.random()*2}));
function drawStars(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#ff3eb5";
  stars.forEach(s=>{
    ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
    s.y+=0.3;if(s.y>innerHeight)s.y=0;
  });
  requestAnimationFrame(drawStars);
}
drawStars();

/* === 🩵 Fertigmeldung === */
console.log("DeepButterflyRealm 🦋 läuft mit Google-Übersetzung, Uhrzeit, Spielen und Avataren.");
</script>
</body>
</html>


